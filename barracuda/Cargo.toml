[package]
name = "hotspring-barracuda"
version = "0.5.6"
edition = "2021"
description = "Nuclear EOS + GPU MD validation for BarraCUDA — L1/L2/L3 physics, Yukawa OCP, typed errors, provenance, capability-based discovery"
license = "AGPL-3.0"

[workspace]

# ── Lint configuration (applies to all targets: lib + bins) ──
# Physics code justifies these clippy patterns.
# See lib.rs for per-lint rationale.
[workspace.lints.clippy]
pedantic = { level = "warn", priority = -1 }
cast_precision_loss = "allow"
cast_possible_truncation = "allow"
cast_sign_loss = "allow"
cast_possible_wrap = "allow"
cast_lossless = "allow"
similar_names = "allow"
many_single_char_names = "allow"
suboptimal_flops = "allow"
doc_markdown = "allow"
module_name_repetitions = "allow"
must_use_candidate = "allow"
return_self_not_must_use = "allow"
missing_panics_doc = "allow"
missing_errors_doc = "allow"
use_self = "allow"
redundant_else = "allow"
inline_always = "allow"
struct_field_names = "allow"
items_after_statements = "allow"
wildcard_imports = "allow"
unreadable_literal = "allow"
imprecise_flops = "allow"
implicit_hasher = "allow"
needless_pass_by_value = "allow"
cognitive_complexity = "allow"
too_many_lines = "allow"
option_if_let_else = "allow"
too_many_arguments = "allow"
type_complexity = "allow"
needless_range_loop = "allow"
assigning_clones = "allow"
manual_clamp = "allow"
manual_let_else = "allow"
significant_drop_tightening = "allow"
collection_is_never_read = "allow"
needless_for_each = "allow"
no_effect_underscore_binding = "allow"
unused_self = "allow"
used_underscore_binding = "allow"
float_cmp = "allow"
assertions_on_constants = "allow"
match_same_arms = "allow"

[lints]
workspace = true

[dependencies]
# BarraCUDA: All scientific computing from the library
barracuda = { path = "../../phase1/toadstool/crates/barracuda" }

# Data loading
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

# Parallelism for L2 HFB
rayon = "1.8"

# Byte casting for GPU uniform buffers
bytemuck = { version = "1.14", features = ["derive"] }

# Async runtime for GPU validation (validate_md)
tokio = { version = "1.35", features = ["rt-multi-thread", "macros"] }

# GPU compute (wgpu for SHADER_F64 FP64 science compute)
wgpu = { version = "0.19", features = ["wgsl"] }

# ── L1 validation (NMP-constrained, Pareto sweep, multi-seed) ──────
[[bin]]
name = "nuclear_eos_l1_ref"
path = "src/bin/nuclear_eos_l1_ref.rs"

# ── L2 validation (L1-seeded DirectSampler, HFB) ───────────────────
[[bin]]
name = "nuclear_eos_l2_ref"
path = "src/bin/nuclear_eos_l2_ref.rs"

# ── L2 GPU-batched HFB (BatchedEighGpu from toadstool) ─────────
[[bin]]
name = "nuclear_eos_l2_gpu"
path = "src/bin/nuclear_eos_l2_gpu.rs"

# ── L2 heterogeneous pipeline (cascade: NMP → L1 → classifier → HFB)
[[bin]]
name = "nuclear_eos_l2_hetero"
path = "src/bin/nuclear_eos_l2_hetero.rs"

# ── BarraCUDA library validation suites ─────────────────────────────
[[bin]]
name = "validate_special_functions"
path = "src/bin/validate_special_functions.rs"

[[bin]]
name = "validate_linalg"
path = "src/bin/validate_linalg.rs"

[[bin]]
name = "validate_optimizers"
path = "src/bin/validate_optimizers.rs"

[[bin]]
name = "validate_md"
path = "src/bin/validate_md.rs"

# ── GPU FP64 validation (L1 + L2 on RTX 4070 via SHADER_F64) ────
[[bin]]
name = "nuclear_eos_gpu"
path = "src/bin/nuclear_eos_gpu.rs"

# ── HFB physics verification (Rust vs Python) ────────────────────
[[bin]]
name = "verify_hfb"
path = "src/bin/verify_hfb.rs"

# ── Sarkas GPU: Yukawa OCP molecular dynamics on consumer GPU ────
[[bin]]
name = "sarkas_gpu"
path = "src/bin/sarkas_gpu.rs"

# ── f64 builtin test: check if native sqrt/exp work on f64 ────
[[bin]]
name = "f64_builtin_test"
path = "src/bin/f64_builtin_test.rs"

# ── PPPM Coulomb validation (toadstool PppmGpu, kappa=0) ────
[[bin]]
name = "validate_pppm"
path = "src/bin/validate_pppm.rs"

# ── Cell-list force diagnostic: compare all-pairs vs cell-list kernels ────
[[bin]]
name = "celllist_diag"
path = "src/bin/celllist_diag.rs"

# ── BarraCUDA full-pipeline validation (ops → Yukawa OCP → energy conservation) ──
[[bin]]
name = "validate_barracuda_pipeline"
path = "src/bin/validate_barracuda_pipeline.rs"

# ── BarraCUDA HFB pipeline validation (BCS bisection + eigensolve) ──
[[bin]]
name = "validate_barracuda_hfb"
path = "src/bin/validate_barracuda_hfb.rs"

# ── L3 deformed HFB (CPU Rayon) ───────────────────────────────────
[[bin]]
name = "nuclear_eos_l3_ref"
path = "src/bin/nuclear_eos_l3_ref.rs"

# ── L3 deformed HFB (GPU-resident — all physics on GPU) ──────────
[[bin]]
name = "nuclear_eos_l3_gpu"
path = "src/bin/nuclear_eos_l3_gpu.rs"

# ── Nuclear EOS validation: pure Rust replication of Python controls ──
[[bin]]
name = "validate_nuclear_eos"
path = "src/bin/validate_nuclear_eos.rs"

# ── Meta-validator: runs all validation suites ─────────────────────────
[[bin]]
name = "validate_all"
path = "src/bin/validate_all.rs"
